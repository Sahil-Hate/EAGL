<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>User Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
     <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
     <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
 
     <script src="http://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="crossorigin="anonymous"></script>
   <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
   <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" ></script>
   <script src="https://kit.fontawesome.com/db71ca3f4b.js" crossorigin="anonymous"></script>

   <link rel="stylesheet" href="{% static 'css/table.css' %}">
   <link rel="stylesheet" href="{% static 'css/popupforms.css'%}">
   <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
   <style>
    #map {
        height: 280px;
        /* The height is 400 pixels */
        width: 100%;
        /* The width is the width of the web page */
    }
   </style>
  </head>
  <body>
    <div id="id01" class="modal">
      <div class="wrapperx2">
        <br><br>
        <div class="wrapperx">
          <span onclick="zindexchanger2()" class="close-span">
            <i class="fa fa-times" aria-hidden="true"></i>
          </span>
          <div class="title">
            Add User
          </div>
          <div class="signup-form">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <p>Please fill in this form to add user details</p>
                <hr>
        
                <!-- username -->
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <span class="fa fa-user"></span>
                            </span>                    
                        </div>
                        <input type="text" class="form-control" name="username" placeholder="Name" required="required">
                    </div>
                </div>
        
                <!-- email -->
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <span class="fa fa-paper-plane"></span>
                            </span>                    
                        </div>
                        <input type="email" class="form-control" name="email" placeholder="Email Address" required="required">
                    </div>
                </div>
        
                 <!-- phone number -->
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <span class="fa fa-phone"></span>
                            </span>                    
                        </div>
                        <input type="text" class="form-control" name="phone_number" placeholder="Phone Number" required="required">
                    </div>
                </div>
        
                <!-- hamlet -->
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <span class="fa fa-address-card"></span>
                            </span>                    
                        </div>
                        <input type="text" class="form-control" name="hamlet" placeholder="Hamlet/Village" required="required">
                    </div>
                </div>
        
                <!-- block -->
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <span class="fa fa-home"></span>
                            </span>                    
                        </div>
                        <input type="text" class="form-control" name="block" placeholder="Block No" required="required">
                    </div>
                </div>
        
                <!-- latitude -->
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="fa fa-arrows-v"></i>
                            </span>                    
                        </div>
                        <input type="text" class="form-control" name="latitude" placeholder="Latitude" required="required">
                    </div>
                </div>
        
                <!-- longitude -->
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="fa fa-arrows-h"></i>
                            </span>                    
                        </div>
                        <input type="text" class="form-control" name="longitude" placeholder="Longitude" required="required">
                    </div>
                </div>
        
                <!-- policy number -->
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="fa fa-edit"></i>
                            </span>                    
                        </div>
                        <input type="text" class="form-control" name="po_number" placeholder="PO Number" required="required">
                    </div>
                </div>
        
                <!-- Sign Up -->
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-lg signup" id="signup11">Submit</button>
                </div>
        
                <!-- Messages -->
                <!-- <div>
                    {% if error %}
                        <h4>{{error}}</h4>
                    {% endif %}
                </div> -->
            </form>
            <br>
        </div>
        </div>
      </div>	
    </div>
    <div id="divx">
        <div id="wrap" class="folder">
            <div class="container">
                <img style="width: 220px;" src="{% static 'images/eagl-bg.png' %}" alt=""><br><br>
                <h2><b>User List</b></h2>
                <a style="float: left !important;text-decoration: none;" href="{% url 'login' %}"">
                  <button type="button" class="add">Back</button>
                </a>
                
                <button type="button" onclick="zindexchanger()" class="add">Add User</button>
                <button type="button" onclick="location.href='{% url 'logout' %}'" class="add" style="margin-right: 2%;">Logout</button>
                
                <div>
                    {% if error %}
                        {%for message in messages%}
                            <p style="color: red; text-align:center; margin-left:20px">{{message}}</p>
                        {%endfor%}
                    {% endif %}
                </div>
                <br><br>
                <div class="chartdiv container">
                    <div class="wrapperx" style="margin-right: 9px;">
                        <h4 style="color:black">Goat Count Status</h4>
                        <div class="chart" id="piechart"></div>
                    </div>
                    <div class="wrapperx">
                        <h4 style="color:black">User's Location</h4>
                        <!--The div element for the map -->
                        <div id="map"></div>
                    </div>
                </div>
                <div id="wrap" class="folder">
                    <div class="container"> 
                        <table class="table table-fluid" id="myTable">
                            <thead>
                                <tr>
                                    <th>Sr.No</th>
                                    <th>Name</th>
                                    <th>Email Address</th>
                                    <th>Phone Number</th>
                                    <th>Hamlet</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr>  
                                <td data-label="Sr.No"><a href="{% url 'userdetail' user.id %}">{{forloop.counter}}</a></td>
                                <td data-label="Name<"><a href="{% url 'userdetail' user.id %}">{{user.username}}</a></td>
                                <td data-label="Email Address"><a href="{% url 'userdetail' user.id %}">{{user.email}}</a></td>
                                <td data-label="Phone Number"><a href="{% url 'userdetail' user.id %}">{{user.phone_number}}</a></td>
                                <td data-label="Hamlet"><a href="{% url 'userdetail' user.id %}">{{user.hamlet}}</a></td>
                                <td data-label="Actions">
                                    <a href="{% url 'update_user' user.id %}"><button type="button" class="btn btn-warning btn-sm">Edit</button></a>
                                    <a href="{% url 'delete_user' user.id %}"><button type="button" class="btn btn-danger btn-sm">Delete</button></a>
                                </td>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
         </div>
    </div>
  </body>
<script>
  function zindexchanger(){
    document.getElementById('wrap').style.zIndex='99'
    $('#divx').fadeOut();
    document.getElementById('id01').style.display='block'
    $('#id01').fadeIn();
  }
  function zindexchanger2(){
    document.getElementById('id01').style.display='none'
    $('#divx').fadeIn();
    document.getElementById('wrap').style.zIndex='101'
  }
</script>
<script>
  function myFunction() {
    // Declare variables
    var input, filter, ul, li, a, i, txtValue;
    input = document.getElementById('myInput');
    filter = input.value.toUpperCase();
    ul = document.getElementById("myUL");
    li = ul.getElementsByTagName('li');
  
    // Loop through all list items, and hide those who don't match the search query
    for (i = 0; i < li.length; i++) {
      a = li[i].getElementsByTagName("span")[0];
      txtValue = a.textContent || a.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        li[i].style.display = "";
      } else {
        li[i].style.display = "none";
      }
    }
  }
  </script>
  <script>
    $(document).ready( function () {
    $('#myTable').DataTable();
} );
</script>
<script type="text/javascript">
	google.charts.load('current', {'packages':['corechart']});
	google.charts.setOnLoadCallback(drawChart);

	function drawChart() {
		var x = {{goat_count_pie_total|safe}}
		var data = google.visualization.arrayToDataTable(x,false);
        
		var options = {
			title: 'Total Count of goats: {{num_goats}}',
			'width':400,
			'height':250
		};

		var chart = new google.visualization.PieChart(document.getElementById('piechart'));
		
		chart.draw(data, options);
	}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBC9_J35LaXXHa-6Jtt3i2ZxpaKrjzzF8g&callback=initMap&libraries=&v=weekly" async></script>
<script>
    function initMap() {
        // The location of Thane
        const thane = { lat: 19.2183, lng: 72.9781 };

        // The map, centered at Thane
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 8,
          center: thane,
        });

        var marker_num = {{map_chart|safe}}
        for (let i = 0; i < marker_num.length; i++) {
            var marker = marker_num[i];
            new google.maps.Marker({
              position: { lat: marker[1], lng: marker[2] },
              map,
              title: marker[0],
              zIndex: marker[3],
            });
            
        }
            
    }
</script>
</html>